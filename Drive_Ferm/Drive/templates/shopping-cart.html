<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Font Awesome -->
	<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
	rel="stylesheet"
	/>
	<!-- Google Fonts -->
	<link
	href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
	rel="stylesheet"
	/>
	<!-- MDB -->
	<link
	href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.2.0/mdb.min.css"
	rel="stylesheet"
	/>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<title>Document</title>

	<style>


/* .card-registration .select-input.form-control[readonly]:not([disabled]) {
font-size: 1rem;
line-height: 2.15;
padding-left: .75em;
padding-right: .75em;
} */

.card-registration .select-arrow {
top: 13px;
}

.bg-grey {
	background-color: rgba(32, 107, 196, 0.04);
}

@media (min-width: 992px) {
.card-registration-2 .bg-grey {
border-top-right-radius: 4px;
border-bottom-right-radius: 4px;
}
/* .price{
	margin-top: 15px;
}
.dp{
	margin-top: 20px;
} */

.UP{
	margin-left: 10.5em !important;
}
}

@media (max-width: 1199px) {
	.UP{
	margin-left: 20% !important;
}
}
@media (max-width: 991px) {
.card-registration-2 .bg-grey {
border-bottom-left-radius: 4px;
border-bottom-right-radius: 4px;
}
.price{
	margin-top: 15px;
}
.dp{
	margin-top: 20px;
}
.UP{
	margin-left: 30% !important;
}
}
.links-container {
  display: flex;
  justify-content: space-between; /* This will space out your two divs */
  align-items: center; /* This will vertically center the links if they have different heights */
}

.link-back-to-shop,
.link-update-selection {
  /* If you want the links to take up equal space */
  flex: 1; 
}

	</style>
</head>
<body>
	<section class="h-100 h-custom" style="background-color: rgba(32, 107, 196, 0.04);">
		<div class="container py-5 h-100">
		  <div class="row d-flex justify-content-center align-items-center h-100">
			<div class="col-12">
			  <div class="card card-registration card-registration-2" style="border: 1px solid rgba(4, 32, 69, 0.14); box-shadow:0 0 4px rgba(24, 36, 51, 0.04)">
				<div class="card-body p-0">
				  <div class="row g-0">
					<div class="col-lg-8">
					  <div class="p-5">
						<div class="d-flex justify-content-between align-items-center mb-5">
						  <h1 class="fw-bold mb-0 text-black">Shopping Cart</h1>
						  <h6 class="mb-0 text-muted">{{total_item_instances}} items</h6>
						</div>
						
							{% for item in cart_items %}
							<hr class="my-4">
							<div class="row mb-4 d-flex justify-content-between align-items-center cart-item">
								<div class="col-md-2 col-lg-2 col-xl-2">
									<img
									src={{ item.product.image.url }}
									class="img-fluid rounded-3" alt="Cotton T-shirt">
								</div>
								<div class="col-md-3 col-lg-3 col-xl-3 dp">
									<h6 class="text-muted">{{ item.product.product_name }}</h6>
								</div>
								<div class="col-md-3 col-lg-3 col-xl-2 d-flex">
									<button class="btn btn-link px-2"
									onclick="this.parentNode.querySelector('input[type=number]').stepDown()">
									<i class="fas fa-minus"></i>
									</button>
			
									<input id="form1" min="0" name="quantity" value="{{ item.quantity }}" type="number"class="form-control quantity-input" />
									<input type="hidden" name="item_id" value="{{ item.id }}" class="id-input">
									<button class="btn btn-link px-2" onclick="this.parentNode.querySelector('input[type=number]').stepUp()">
									<i class="fas fa-plus"></i>
									</button>
								</div>
								<div class="col-md-3 col-lg-2 col-xl-2 offset-lg-1 price">
									{% for pricing in item.product.pricing.all %}
										{% if pricing.quantity == item.volume %}
											<h6 class="mb-0">{{ pricing.price }} €</h6>
										{% endif %}
									{% endfor %}
								</div>
								<div class="col-md-1 col-lg-1 col-xl-1 text-end">
									<a href="#!" class="text-muted"><i class="bi bi-trash"></i></a>
								</div>
							</div>
							{% endfor %}
							<hr class="my-4">
							<div class="links-container">
								<form action="{% url 'bulk-update-cart-items' %}" method="post">
									<div class="link-back-to-shop">
										<h6 class="mb-0"><a href="#!" type="submit" class="text-body"><i class="fas fa-long-arrow-alt-left me-2"></i>Back to shop</a></h6>
									</div>
								</form>
								<div class="link-update-selection">
									<h6 class="mb-0"><button class="text-body UP" id="update-cart-btn">update selection!</button></h6>
								</div>
							</div>
					  </div>
					</div>
					<div class="col-lg-4 bg-grey">
					  <div class="p-5">
						<h3 class="fw-bold mb-5 mt-2 pt-1">Summary</h3>
						<hr class="my-4">
	  
						<h5 class="text-uppercase mb-3">Shipping</h5>
	  
						<div class="mb-4 pb-2">
							<h6 class="text-uppercase">Standard-Delivery - €5.00</h6>
						</div>
	  
						<h5 class="text-uppercase mb-3">Give code</h5>
						<form action="{% url 'createcheckoutsession' %}" method="post">
							{% csrf_token %}
							<div class="mb-5">
								<div class="form-outline">
									<input type="text" class="form-control form-control-lg" id="coupon-code" name="coupon-code" />
									<label class="form-label" for="coupon-code">Enter your code</label>
								</div>
								<div class="form-outline">
									<!-- This button should have a JavaScript event handler that listens for clicks and then submits the form or makes an AJAX request -->
									<button type="button" class="btn btn-dark btn-block btn-lg" id="apply-coupon-btn" data-mdb-ripple-color="dark">apply Code</button>
								</div>
							</div>
						
							<hr class="my-4">
						
							<div class="d-flex justify-content-between mb-5">
								<h5 class="text-uppercase">Total price</h5>
								<h5 id="total-price">{{ total_price }} €</h5>
							</div>
						
							<!-- This is the submit button for the form -->
							<button type="submit" class="btn btn-dark btn-block btn-lg" data-mdb-ripple-color="dark">Check Out</button>
						</form>
						
					  </div>
					</div>
				  </div>
				</div>
			  </div>
			</div>
		  </div>
		</div>
	  </section>
</body>
<script>

	document.getElementById('apply-coupon-btn').addEventListener('click', function() {
		var code = document.getElementById('coupon-code').value;
		fetch('/apply-coupon/', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'X-CSRFToken': '{{ csrf_token }}'
			},
			body: JSON.stringify({code: code})
		})
		.then(response => response.json())
		.then(data => {
			console.log(data.total)
			document.getElementById('total-price').innerText = data.total;

		})
		.catch(error => console.error('Error:', error));
	});
	</script>
<script>
	document.getElementById('update-cart-btn').addEventListener('click', function() {
		const updates = [];
		document.querySelectorAll('.cart-item').forEach(item => {
			const cartItemId = item.querySelector('.id-input').value;
			const quantity = item.querySelector('.quantity-input').value;
			updates.push({id: cartItemId, quantity: quantity});
		});
		console.log(updates);
		fetch('/shopping-cart/bulk-update-cart-items/', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'X-CSRFToken': '{{ csrf_token }}'
			},
			body: JSON.stringify({updates: updates})
		})
		.then(response => response.json())
		.then(data => {
			if(data.status === 'success') {
				console.log('Cart updated');
				// Optionally, refresh part of the page to show the updated totals
			} else {
				console.error('Error updating cart');
			}
		})
		.catch(error => console.error('Error:', error));
	});
	</script>
</html>


